<header>
  <nav class="navbar navbar-expand-md navbar-light bg-white shadow-sm fixed-top py-2">
    <div class="container-fluid d-flex align-items-center px-3">

      <!-- ハンバーガー（左端） -->
      <button class="navbar-toggler mr-2" type="button" data-toggle="collapse" data-target="#navbarMenu"
        aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- ロゴ -->
      <%= link_to "PlayMap", root_path, class: "navbar-brand font-weight-bold h4 text-primary mr-auto" %>

      <!-- 右上アイコン群 -->
      <div class="d-flex align-items-center">
        <% if current_user %>
          <!-- 通知ベル -->
          <div class="dropdown position-relative ml-3 mr-3">
            <%= link_to notifications_path, class: "text-dark position-relative" do %>
              <i class="fa fa-bell fa-lg"></i>
              <% if unchecked_notifications_count.positive? %>
                <span class="badge badge-danger position-absolute" style="top: 0; right: 0; transform: translate(50%, -50%);">
                  <%= unchecked_notifications_count %>
                </span>
              <% end %>
            <% end %>
          </div>
        <% end %>

        <!-- 検索アイコン -->
        <button class="btn btn-link text-dark p-0" id="searchToggle">
          <i class="fas fa-search fa-lg"></i>
        </button>
      </div>

      <!-- メニュー（折りたたみ時は下にスライド） -->
      <div class="collapse navbar-collapse mt-2 mt-md-0" id="navbarMenu">
        <ul class="navbar-nav ml-auto align-items-md-center">

          <% if current_user %>
            <!-- マイページ -->
            <li class="nav-item">
              <%= link_to mypage_path, class: "nav-link d-flex align-items-center" do %>
                <i class="fas fa-user mr-2"></i> マイページ
              <% end %>
            </li>

            <!-- 一覧ドロップダウン -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="listDropdown"
                 role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-list mr-2"></i> 一覧
              </a>
              <div class="dropdown-menu" aria-labelledby="listDropdown">
                <%= link_to "投稿一覧", posts_path, class: "dropdown-item" %>
                <%= link_to "レビューリスト", reviews_path, class: "dropdown-item" %>
                <%= link_to "場所一覧", places_path, class: "dropdown-item" %>
                <%= link_to "イベント一覧", events_path, class: "dropdown-item" %>
                <%= link_to "ユーザーリスト", users_path, class: "dropdown-item" %>
              </div>
            </li>

            <!-- ログアウト -->
            <li class="nav-item">
              <%= link_to destroy_user_session_path, method: :delete,
                  class: "nav-link text-danger d-flex align-items-center" do %>
                <i class="fas fa-sign-out-alt mr-2"></i> ログアウト
              <% end %>
            </li>
          <% else %>
            <!-- 未ログイン時 -->
            <li class="nav-item mr-2">
              <%= link_to new_user_registration_path, class: "btn btn-outline-primary" do %>
                <i class="fas fa-user-plus mr-1"></i> 新規登録
              <% end %>
            </li>
            <li class="nav-item">
              <%= link_to new_user_session_path, class: "btn btn-outline-primary" do %>
                <i class="fas fa-sign-in-alt mr-1"></i> ログイン
              <% end %>
            </li>
          <% end %>

        </ul>
      </div>
    </div>
  </nav>

  <!-- 検索フォーム -->
  <div id="searchFormWrapper" class="bg-light px-3 py-2 shadow-sm position-fixed w-100 d-none"
       style="top: 60px; z-index: 1050;">
    <%= render 'public/shared/search_form' %>
  </div>
</header>