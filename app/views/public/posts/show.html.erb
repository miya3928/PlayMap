<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-lg overflow-hidden">
    <div class="card-body p-md-5">

      <%= render 'public/posts/detail', post: @post, postable: @postable %>
        
      <div class="mt-5 pt-4 border-top">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="text-success fw-bolder mb-0"><i class="fas fa-certificate me-2"></i> ユーザーレビュー</h2>
          <%= link_to new_post_review_path(@post), class: "btn btn-success rounded-pill px-4 shadow" do %>
            <i class="fa-regular fa-pen-to-square me-1"></i> レビューを書く
          <% end %>
        </div>

        <% if @post.reviews.any? %>
          <div class="row g-4 mt-3">
            <% @post.reviews.each do |review| %>
              <div class="col-md-6">
                <div class="card shadow-sm p-3 rounded-lg h-100 review-list-card">

                  <% if review.image.attached? %>
                    <div class="mb-2 text-center">
                      <%= display_image_or_default(review.image, width: 400, height: 250, classes: "img-fluid rounded shadow-sm review-image-list") %>
                    </div>
                  <% end %>

                  <div class="card-body d-flex flex-column p-2">
                    <%= render 'public/reviews/display', review: review %>

                    <p class="mb-2 small mt-2"><%= truncate(review.body, length: 70) %></p>

                    <p class="text-muted mt-auto mb-2 small">
                      <%= display_image_or_default(review.user.image, width: 25, height: 25, classes: "rounded-circle me-1") %>
                      <%= link_to review.user.name, user_path(review.user), class: "text-decoration-none text-primary" %>さん
                    </p>

                    <div class="text-end">
                      <%= link_to "続きを読む", post_review_path(@post, review), class: "btn btn-outline-primary btn-sm rounded-pill" %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="alert alert-warning text-center mt-3" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i> まだレビューがありません。一番に感想を投稿しませんか？
          </div>
        <% end %>
      </div>

      <div class="mt-5 pt-4 border-top">
        <h3 class="text-info fw-bold mb-4"><i class="fas fa-comment me-2"></i> 投稿へのコメント</h3>

        <div class="p-4 bg-light rounded-lg shadow-sm mb-5">
          <%= render 'public/comments/form', commetable: @post %>
        </div>

        <h4 class="text-secondary fw-bold mb-3"><i class="fas fa-comments me-2"></i> みんなのコメント</h4>
        <%= render 'public/comments/lists', commetable: @post %>
      </div>

    </div>
  </div>
</div>