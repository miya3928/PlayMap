<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-lg overflow-hidden">
    <div class="card-body">
      <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
      <div class="mb-4 d-flex justify-content-between align-items-center">
        <%= link_to post_path(@review.post), class: "btn btn-secondary rounded-circle p-3 d-flex justify-content-center align-items-center shadow-sm", style: "width:3rem;height:3rem;" do %>
          <i class="fa-solid fa-arrow-left"></i> 
        <% end %>
      </div>

      <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼æƒ…å ± -->
      <div class="mb-4">
        <h2 class="text-success fw-bold">ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</h2>
        <div class="text-muted small mb-2">
          <i class="fa-regular fa-clock"></i> <%= l(@review.created_at, format: :short) %>
        </div>

        <p class="mb-2">
          <strong>æŠ•ç¨¿è€…:</strong>
          <%= display_image_or_default(@review.user.image, width: 30, height: 30, classes: "rounded-circle me-1") %>
          <%= link_to @review.user.name, user_path(@review.user), class: "text-decoration-none text-primary fw-bold" %>
        </p>

        <div class="review-score mb-3" data-score="<%= @review.score %>"></div>

        <p class="mb-4"><%= simple_format(@review.body) %></p>
      </div>

      <!-- å…ƒã®æŠ•ç¨¿ã®ç°¡æ˜“è¡¨ç¤º -->
      <div class="card bg-light border-0 shadow-sm mb-5">
        <div class="card-body">
          <h5 class="text-muted fw-bold">ğŸ“Œ ã“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«é–¢é€£ã™ã‚‹æŠ•ç¨¿</h5>
          <p class="mb-1"><strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> <%= link_to @post.title, post_path(@post), class: "text-decoration-none text-primary" %></p>
          <p class="mb-1"><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> <%= @post.postable_type_display %></p>
          <p class="mb-1"><strong>å†…å®¹:</strong> <%= truncate(@post.body, length: 100) %></p>
          <p class="text-muted small">æŠ•ç¨¿æ—¥æ™‚ï¼š<%= l(@post.created_at, format: :short) %></p>
        </div>
      </div>

      <!-- ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="mt-5">
        <h3 class="text-info mb-3">ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
        <%= render 'public/comments/form', commetable: @review %>

        <div class="mt-4">
          <h4 class="text-secondary mb-4">ã¿ã‚“ãªã®ã‚³ãƒ¡ãƒ³ãƒˆ</h4>
          <%= render 'public/comments/lists', commetable: @review %>
        </div>
      </div>

      <% if @review.user == current_user %>
        <div class="text-end mt-4">
          <%= link_to "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤", post_review_path(@post, @review), method: :delete,
              data: { confirm: 'æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ' },
              class: "btn btn-outline-danger" %>
        </div>
      <% end %>
    </div>
  </div>
</div>


<script>
document.addEventListener("turbolinks:load", () => {
  document.querySelectorAll(".review-score:not(.raty-applied)").forEach((elem) => {
    const score = parseFloat(elem.dataset.score);
    
    raty(elem, {
      readonly: true,
      score: score,
      number: 5,
      starOn: "<%= asset_path('star-on.png') %>",
      starOff: "<%= asset_path('star-off.png') %>",
      starHalf: "<%= asset_path('star-half.png') %>",
    });

    elem.classList.add('raty-applied'); // é©ç”¨æ¸ˆã¿ã®è¦ç´ ã«ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
    elem.querySelectorAll('img').forEach((star) => {
      star.style.pointerEvents = 'none'; // æ˜Ÿãƒãƒ¼ã‚¯ç”»åƒã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–
    });
  });
});
</script>
